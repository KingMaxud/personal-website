---
import Main from '../../components/projects/Main.tsx'
import Layout from '../../layouts/Layout.astro'

function capitalizeFirstLetter(str) {
   return str.charAt(0).toUpperCase() + str.slice(1)
}

export async function getStaticPaths() {
   const query = `
      query Projects {
        projects {
          name
          description
          images {
            url
          }
          technologies {
            id
            name
            why
            type
          }
        }
      }
   `

   try {
      const { data: { projects } } = await fetch(
         'https://eu-central-1-shared-euc1-02.cdn.hygraph.com/content/clgxslz6k19ny01umdcohdlwh/master',
         {
            method: 'POST',
            headers: {
               'Content-Type': 'application/json',
            },
            body: JSON.stringify({ query }),
         },
      ).then(res => res.json())

      return projects.map(project => ({
         params: { project: project.name.toLowerCase() },
         props: { data: project }
      }))
   } catch (error) {
      console.error(error)
      return []
   }
}

const { project } = Astro.params
const { data } = Astro.props
const capitalizedProject = capitalizeFirstLetter(project)
---

<Layout title={`${capitalizedProject} Project`}>
   <Main data={data} client:visible />
</Layout>
